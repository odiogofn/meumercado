<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Controle de Compras - Meses, Listas e Carteiras</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- CSS -->
  <link rel="stylesheet" href="styles.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- JS -->
  <script defer src="app.js"></script>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div>
        <h1>Controle de Compras</h1>
        <p class="app-subtitle">
          Organize suas compras por mÃªs, listas, carteiras e acompanhe tudo com grÃ¡ficos.
        </p>
      </div>
      <button class="btn btn-outline" id="btnLimparLista" title="Limpar apenas a lista atual">
        ğŸ§¹ Limpar lista atual
      </button>
    </header>

    <main class="layout">
      <!-- COLUNA ESQUERDA -->
      <section class="col-sidebar">
        <!-- Meses e Listas -->
        <div class="card">
          <div class="section-title">
            <span class="icon">ğŸ“†</span>
            <span>Meses e listas</span>
          </div>

          <div class="form-row">
            <label for="selectMes" class="label">MÃªs de referÃªncia</label>
            <div class="inline-row">
              <select id="selectMes" class="input-select"></select>
              <button class="btn btn-outline btn-sm" id="btnNovoMes">
                â• Novo mÃªs
              </button>
            </div>
          </div>

          <div class="form-row">
            <label for="selectLista" class="label">Lista dentro do mÃªs</label>
            <div class="inline-row">
              <select id="selectLista" class="input-select"></select>
              <button class="btn btn-outline btn-sm" id="btnNovaListaMes">
                â• Nova lista
              </button>
            </div>
          </div>

          <p class="helper-text">
            Exemplo: MÃªs 11/2025 â†’ listas "Compra grande", "ReposiÃ§Ã£o", "Churrasco".
          </p>
        </div>

        <!-- Carteiras -->
        <div class="card">
          <div class="section-title">
            <span class="icon">ğŸ‘›</span>
            <span>Carteiras / formas de pagamento</span>
          </div>

          <div class="form-row">
            <label for="novaCarteiraNome" class="label">Nova carteira</label>
            <div class="inline-row">
              <input
                type="text"
                id="novaCarteiraNome"
                class="input-text"
                placeholder="Ex: Pix, CrÃ©dito Nubank, DÃ©bito Caixa, VR, Dinheiro"
              >
              <button class="btn btn-outline btn-sm" id="btnAdicionarCarteira">
                â• Adicionar
              </button>
            </div>
          </div>

          <p class="helper-text">
            As carteiras aparecem para seleÃ§Ã£o em cada item.
          </p>

          <div id="listaCarteirasResumo" class="chips"></div>
        </div>
      </section>

      <!-- COLUNA DIREITA -->
      <section class="col-main">
        <!-- OrÃ§amento -->
        <div class="card">
          <div class="section-title">
            <span class="icon">ğŸ’°</span>
            <span>OrÃ§amento da lista atual</span>
          </div>

          <div class="form-row orcamento-row">
            <label class="checkbox-label">
              <input type="checkbox" id="usarOrcamento">
              Ativar controle de orÃ§amento
            </label>
            <input
              type="number"
              id="valorOrcamento"
              class="input-number"
              placeholder="Valor disponÃ­vel (ex: 300,00)"
              step="0.01"
              min="0"
              disabled
            >
          </div>

          <p class="helper-text">
            Cada lista (dentro do mÃªs) pode ter seu prÃ³prio orÃ§amento.
          </p>
        </div>

        <!-- Itens da lista -->
        <div class="card">
          <div class="section-title">
            <span class="icon">ğŸ›’</span>
            <span>Itens da lista atual</span>
          </div>

          <div class="form-grid">
            <div class="field field-produto">
              <label for="produto" class="label">Produto</label>
              <input
                type="text"
                id="produto"
                list="listaProdutos"
                class="input-text"
                placeholder="Ex: Arroz, Carne, SabÃ£o em pÃ³"
              >
              <datalist id="listaProdutos"></datalist>
            </div>

            <div class="field field-categoria">
              <label for="categoria" class="label">Categoria</label>
              <input
                list="listaCategorias"
                id="categoria"
                class="input-text"
                placeholder="Ex: Hortifruti, Carne, Limpeza"
              >
              <datalist id="listaCategorias">
                <option value="Hortifruti"></option>
                <option value="Carnes"></option>
                <option value="Padaria"></option>
                <option value="Bebidas"></option>
                <option value="Limpeza"></option>
                <option value="Higiene"></option>
                <option value="Mercearia"></option>
                <option value="Frios"></option>
              </datalist>
            </div>

            <div class="field field-carteira">
              <label for="carteiraItem" class="label">Carteira</label>
              <select id="carteiraItem" class="input-select"></select>
            </div>

            <div class="field field-qtde">
              <label for="quantidade" class="label">Quantidade</label>
              <input
                type="number"
                id="quantidade"
                class="input-number"
                step="0.01"
                min="0"
              >
            </div>

            <div class="field field-unidade">
              <label for="unidade" class="label">Unidade</label>
              <select id="unidade" class="input-select">
                <option value="un">Unidade</option>
                <option value="kg">Kg</option>
                <option value="g">Gramas</option>
                <option value="L">Litros</option>
                <option value="cx">Caixa</option>
              </select>
            </div>

            <div class="field field-preco">
              <label for="preco" class="label">PreÃ§o por un/kg/L (R$)</label>
              <input
                type="number"
                id="preco"
                class="input-number"
                step="0.01"
                min="0"
              >
            </div>

            <div class="field field-btn">
              <label class="label">&nbsp;</label>
              <button class="btn btn-primary btn-full" id="btnAdicionar">
                â• Adicionar item
              </button>
            </div>
          </div>

          <div class="table-wrapper">
            <table class="table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Produto</th>
                  <th>Categoria</th>
                  <th>Carteira</th>
                  <th>Qtd</th>
                  <th class="right">PreÃ§o un/kg/L</th>
                  <th class="right">Total item</th>
                  <th class="right"></th>
                </tr>
              </thead>
              <tbody id="tabelaItensBody"></tbody>
            </table>
          </div>

          <div class="table-footer">
            <span id="infoQuantidadeItens">Nenhum item adicionado ainda.</span>
            <span class="helper-text">
              Use carteiras diferentes para ver o impacto de Pix, crÃ©dito, VR, etc.
            </span>
          </div>
        </div>

        <!-- Resumo da lista -->
        <div class="card">
          <div class="section-title">
            <span class="icon">ğŸ“Š</span>
            <span>Resumo da lista atual</span>
          </div>

          <div class="summary-grid">
            <div class="summary-card">
              <span class="summary-label">Total da lista</span>
              <span class="summary-value" id="totalCompra">R$ 0,00</span>
              <span class="summary-extra" id="summaryItens">0 itens</span>
            </div>

            <div class="summary-card">
              <span class="summary-label">Ticket mÃ©dio por item</span>
              <span class="summary-value" id="ticketMedio">R$ 0,00</span>
              <span class="summary-extra">Total Ã· nÂº de itens</span>
            </div>

            <div class="summary-card">
              <span class="summary-label">Maior gasto em um item</span>
              <span class="summary-value" id="maiorItem">R$ 0,00</span>
              <span class="summary-extra" id="maiorItemNome">â€“</span>
            </div>

            <div class="summary-card">
              <span class="summary-label">Categorias distintas</span>
              <span class="summary-value" id="qtdCategorias">0</span>
              <span class="summary-extra">Perfil de consumo por categoria</span>
            </div>
          </div>

          <div class="budget-bar-container" id="budgetContainer" style="display:none;">
            <span class="summary-label budget-label">UtilizaÃ§Ã£o do orÃ§amento</span>
            <div class="budget-bar-track">
              <div class="budget-bar-fill" id="budgetBar"></div>
            </div>
            <div class="budget-status" id="budgetStatus"></div>
          </div>
        </div>

        <!-- GrÃ¡ficos da lista -->
        <div class="card">
          <div class="section-title">
            <span class="icon">ğŸ“ˆ</span>
            <span>GrÃ¡ficos da lista atual</span>
          </div>

          <div class="charts-grid">
            <div class="chart-card">
              <h3>Gastos por categoria</h3>
              <p class="chart-helper">
                ParticipaÃ§Ã£o de cada categoria dentro da lista selecionada.
              </p>
              <canvas id="chartCategorias" height="220"></canvas>
            </div>
            <div class="chart-card">
              <h3>Top produtos da lista</h3>
              <p class="chart-helper">
                AtÃ© 5 produtos que mais pesam no valor total da lista.
              </p>
              <canvas id="chartTopProdutos" height="220"></canvas>
            </div>
          </div>
        </div>

        <!-- VisÃ£o geral por mÃªs -->
        <div class="card">
          <div class="section-title">
            <span class="icon">ğŸŒ</span>
            <span>VisÃ£o geral por mÃªs</span>
          </div>

          <div class="summary-grid summary-grid-small-margin">
            <div class="summary-card">
              <span class="summary-label">Total geral (todos os meses)</span>
              <span class="summary-value" id="totalGeralMeses">R$ 0,00</span>
              <span class="summary-extra">Soma de todas as listas</span>
            </div>

            <div class="summary-card">
              <span class="summary-label">Meses com dados</span>
              <span class="summary-value" id="qtdMeses">0</span>
              <span class="summary-extra">Com pelo menos uma lista</span>
            </div>

            <div class="summary-card">
              <span class="summary-label">MÃªs com maior gasto</span>
              <span class="summary-value" id="mesTopLabel">â€“</span>
              <span class="summary-extra" id="mesTopValor">R$ 0,00</span>
            </div>

            <div class="summary-card">
              <span class="summary-label">Total de listas</span>
              <span class="summary-value" id="qtdListasTotais">0</span>
              <span class="summary-extra">Somando todos os meses</span>
            </div>
          </div>

          <div class="chart-card">
            <h3>Totais por mÃªs</h3>
            <p class="chart-helper">
              Soma de todas as listas em cada mÃªs.
            </p>
            <canvas id="chartTotaisMeses" height="240"></canvas>
          </div>
        </div>

        <!-- VisÃ£o por carteira -->
        <div class="card">
          <div class="section-title">
            <span class="icon">ğŸ’³</span>
            <span>VisÃ£o por carteira</span>
          </div>

          <div class="chart-card">
            <h3>Totais por carteira</h3>
            <p class="chart-helper">
              Quanto cada carteira (Pix, crÃ©dito, dÃ©bito, VR, etc.) estÃ¡ sendo usada no perÃ­odo completo.
            </p>
            <canvas id="chartCarteiras" height="240"></canvas>
          </div>
        </div>
      </section>
    </main>

    <!-- BACKUP -->
    <section class="backup-section">
      <div class="card">
        <div class="section-title">
          <span class="icon">ğŸ’¾</span>
          <span>Backup de dados</span>
        </div>
        <p class="helper-text">
          Exporte um arquivo de backup (.json) para usar seus dados em outra mÃ¡quina ou navegador ou restaurar em caso de formataÃ§Ã£o.
        </p>
        <div class="backup-actions">
          <button class="btn btn-outline" id="btnExportarBackup">â¬‡ï¸ Exportar backup</button>
          <button class="btn btn-outline" id="btnImportarBackup">â¬†ï¸ Importar backup</button>
          <input type="file" id="inputImportarBackup" accept=".json,application/json" style="display:none;">
        </div>
        <p class="helper-text">
          O backup inclui meses, listas, itens, orÃ§amentos e carteiras.
        </p>
      </div>
    </section>
  </div>

  <!-- MODAL DE EDIÃ‡ÃƒO -->
  <div id="modalEdicao" class="modal-backdrop">
    <div class="modal-dialog">
      <h3 class="modal-title">Editar item</h3>

      <div class="modal-body">
        <label class="edit-label">Produto</label>
        <input id="editProduto" class="edit-input">

        <label class="edit-label">Categoria</label>
        <input id="editCategoria" class="edit-input">

        <label class="edit-label">Carteira</label>
        <select id="editCarteira" class="edit-input"></select>

        <label class="edit-label">Quantidade</label>
        <input id="editQuantidade" type="number" step="0.01" min="0" class="edit-input">

        <label class="edit-label">Unidade</label>
        <select id="editUnidade" class="edit-input">
          <option value="un">Unidade</option>
          <option value="kg">Kg</option>
          <option value="g">Gramas</option>
          <option value="L">Litros</option>
          <option value="cx">Caixa</option>
        </select>

        <label class="edit-label">PreÃ§o un/kg/L (R$)</label>
        <input id="editPreco" type="number" step="0.01" min="0" class="edit-input">
      </div>

      <div class="modal-actions">
        <button id="btnCancelarEdicao" class="btn btn-outline">Cancelar</button>
        <button id="btnSalvarEdicao" class="btn btn-primary">Salvar</button>
      </div>
    </div>
  </div>
</body>
</html>
