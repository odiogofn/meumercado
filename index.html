<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Controle de Compras</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Estilos -->
  <link rel="stylesheet" href="style.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- App -->
  <script defer src="app.js"></script>
</head>
<body>
  <div class="app-container">
    <header class="app-header">
      <div>
        <h1>Controle de Compras</h1>
        <p>Cadastre meses, listas, carteiras, registre as compras e veja o resumo com gráficos.</p>
      </div>
    </header>

    <!-- Abas -->
    <nav class="tabs">
      <button class="tab-button active" data-tab-target="#tabCadastro">1. Cadastro</button>
      <button class="tab-button" data-tab-target="#tabComprando">2. Comprando</button>
      <button class="tab-button" data-tab-target="#tabResumo">3. Resumo das Compras</button>
    </nav>

    <main>
      <!-- ABA 1: CADASTRO -->
      <section id="tabCadastro" class="tab-panel active">
        <!-- Meses -->
        <div class="card">
          <h2>Meses de referência</h2>
          <div class="form-row">
            <label for="cadMesSelect">Mês atual:</label>
            <select id="cadMesSelect"></select>
            <button id="cadNovoMesBtn" class="btn-primary">+ Novo mês</button>
          </div>
          <p id="cadMesResumo" class="text-muted"></p>
        </div>

        <!-- Listas -->
        <div class="card">
          <h2>Listas de compras do mês</h2>
          <div class="form-row">
            <label for="cadListaSelect">Lista ativa:</label>
            <select id="cadListaSelect"></select>
            <button id="cadNovaListaBtn" class="btn-secondary">+ Nova lista</button>
          </div>
          <ul id="cadListasResumo" class="tag-list"></ul>
        </div>

        <!-- Carteiras -->
        <div class="card">
          <h2>Carteiras / Formas de pagamento</h2>
          <div class="form-row">
            <input id="cadCarteiraNome" type="text" placeholder="Ex: Pix, Crédito Nubank, VR, Dinheiro..." />
            <button id="cadAdicionarCarteiraBtn" class="btn-secondary">Adicionar carteira</button>
          </div>
          <div id="cadCarteirasResumo" class="tag-list"></div>
        </div>
      </section>

      <!-- ABA 2: COMPRANDO -->
      <section id="tabComprando" class="tab-panel">
        <!-- Contexto -->
        <div class="card">
          <h2>Contexto da compra</h2>
          <div class="form-row form-row-wrap">
            <div class="field-inline">
              <label for="compMesSelect">Mês:</label>
              <select id="compMesSelect"></select>
            </div>
            <div class="field-inline">
              <label for="compListaSelect">Lista:</label>
              <select id="compListaSelect"></select>
            </div>
          </div>

          <div class="budget-row">
            <label class="inline">
              <input type="checkbox" id="compUsarOrcamento">
              Controlar orçamento desta lista
            </label>
            <input
              type="number"
              id="compValorOrcamento"
              placeholder="Valor disponível (ex: 300,00)"
              step="0.01"
              min="0"
            >
            <span id="compOrcamentoStatus" class="text-muted"></span>
          </div>
        </div>

        <!-- Inclusão de itens -->
        <div class="card">
          <h2>Incluir produtos na lista selecionada</h2>
          <div class="grid-6">
            <div class="field">
              <label for="produto">Produto</label>
              <input type="text" id="produto" list="listaProdutos" placeholder="Ex: Arroz, Carne, Sabão em pó">
              <datalist id="listaProdutos"></datalist>
            </div>

            <div class="field">
              <label for="categoria">Categoria</label>
              <input list="listaCategorias" id="categoria" placeholder="Ex: Hortifruti, Carne, Limpeza">
              <datalist id="listaCategorias">
                <option value="Hortifruti"></option>
                <option value="Carnes"></option>
                <option value="Padaria"></option>
                <option value="Bebidas"></option>
                <option value="Limpeza"></option>
                <option value="Higiene"></option>
                <option value="Mercearia"></option>
                <option value="Frios"></option>
              </datalist>
            </div>

            <div class="field">
              <label for="carteiraItem">Carteira</label>
              <select id="carteiraItem"></select>
            </div>

            <div class="field">
              <label for="quantidade">Quantidade</label>
              <input type="number" id="quantidade" step="0.01" min="0">
            </div>

            <div class="field">
              <label for="unidade">Unidade</label>
              <select id="unidade">
                <option value="un">Unidade</option>
                <option value="kg">Kg</option>
                <option value="g">Gramas</option>
                <option value="L">Litros</option>
                <option value="cx">Caixa</option>
              </select>
            </div>

            <div class="field">
              <label for="preco">Preço un/kg/L (R$)</label>
              <input type="number" id="preco" step="0.01" min="0">
            </div>
          </div>

          <div class="actions-row">
            <button id="btnAdicionarItem" class="btn-primary">
              Adicionar item à lista
            </button>
            <button id="btnLimparLista" class="btn-danger">
              Limpar itens da lista atual
            </button>
          </div>

          <p class="text-muted">
            Dica: escolha o mês, a lista e a carteira antes de incluir os itens.
          </p>
        </div>
      </section>

      <!-- ABA 3: RESUMO -->
      <section id="tabResumo" class="tab-panel">
        <div class="card">
          <h2>Resumo da lista atual</h2>
          <p class="text-muted">
            Mês: <strong id="resumoNomeMes">–</strong> • Lista: <strong id="resumoNomeLista">–</strong>
          </p>

          <div class="summary-grid">
            <div class="summary-card">
              <span class="summary-label">Total da lista</span>
              <span class="summary-value" id="resumoTotalLista">R$ 0,00</span>
              <span class="summary-sub" id="resumoQtdItens">0 itens</span>
            </div>

            <div class="summary-card">
              <span class="summary-label">Ticket médio por item</span>
              <span class="summary-value" id="resumoTicketMedio">R$ 0,00</span>
              <span class="summary-sub">Total ÷ quantidade de itens</span>
            </div>

            <div class="summary-card">
              <span class="summary-label">Maior item</span>
              <span class="summary-value" id="resumoMaiorItemValor">R$ 0,00</span>
              <span class="summary-sub" id="resumoMaiorItemNome">–</span>
            </div>

            <div class="summary-card">
              <span class="summary-label">Categorias distintas</span>
              <span class="summary-value" id="resumoQtdCategorias">0</span>
              <span class="summary-sub">Qtd. de categorias na lista</span>
            </div>
          </div>

          <div class="budget-info" id="resumoBudgetBox" style="display:none;">
            <span id="resumoBudgetTexto"></span>
          </div>

          <div class="table-wrapper">
            <table>
              <thead>
                <tr>
                  <th>#</th>
                  <th>Produto</th>
                  <th>Categoria</th>
                  <th>Carteira</th>
                  <th>Qtd</th>
                  <th>Vlr un</th>
                  <th>Vlr total</th>
                  <th>Ações</th>
                </tr>
              </thead>
              <tbody id="resumoTabelaBody"></tbody>
            </table>
          </div>
        </div>

        <div class="card">
          <h2>Gráficos por categoria</h2>
          <div class="charts-grid">
            <div>
              <h3>Quantidade de produtos x categoria</h3>
              <canvas id="chartQtdCategoria" height="220"></canvas>
            </div>
            <div>
              <h3>Valor total x categoria</h3>
              <canvas id="chartValorCategoria" height="220"></canvas>
            </div>
          </div>
        </div>

        <div class="card">
          <h2>Backup dos dados</h2>
          <p class="text-muted">
            Exporte um arquivo .json com meses, listas, carteiras e itens ou importe um backup antigo.
          </p>
          <div class="form-row">
            <button id="btnExportarBackup" class="btn-secondary">Exportar backup</button>
            <button id="btnImportarBackup" class="btn-secondary">Importar backup</button>
            <input type="file" id="inputImportarBackup" accept=".json,application/json" style="display:none;">
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- Modal de edição -->
  <div id="modalEdicao" class="modal-backdrop">
    <div class="modal-dialog">
      <h3>Editar item</h3>

      <label class="modal-label">Produto</label>
      <input id="editProduto" class="modal-input">

      <label class="modal-label">Categoria</label>
      <input id="editCategoria" class="modal-input">

      <label class="modal-label">Carteira</label>
      <select id="editCarteira" class="modal-input"></select>

      <label class="modal-label">Quantidade</label>
      <input id="editQuantidade" type="number" step="0.01" min="0" class="modal-input">

      <label class="modal-label">Unidade</label>
      <select id="editUnidade" class="modal-input">
        <option value="un">Unidade</option>
        <option value="kg">Kg</option>
        <option value="g">Gramas</option>
        <option value="L">Litros</option>
        <option value="cx">Caixa</option>
      </select>

      <label class="modal-label">Preço un/kg/L (R$)</label>
      <input id="editPreco" type="number" step="0.01" min="0" class="modal-input">

      <div class="modal-actions">
        <button id="btnCancelarEdicao" class="btn-secondary">Cancelar</button>
        <button id="btnSalvarEdicao" class="btn-primary">Salvar</button>
      </div>
    </div>
  </div>
</body>
</html>
